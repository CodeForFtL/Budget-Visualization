<!DOCTYPE html>

<head>
  <meta charset="utf-8" />

  <!-- Set the viewport width to device width for mobile -->
  <meta name="viewport" content="width=device-width" />

  <title>Sankey Example</title>
  
  <!-- Included CSS Files (Uncompressed) -->
  <!--
  <link rel="stylesheet" href="stylesheets/foundation.css">
  -->
  
  <!-- Included CSS Files (Compressed) -->
  <link rel="stylesheet" href="stylesheets/foundation.min.css">
  <link rel="stylesheet" href="stylesheets/app.css">
  
  <script src="js/modernizr.foundation.js"></script>

<style>


  #chart {
    height: 600px;
  }

  #hover_description{
    height: 26px;
  }

  .node rect {
    fill-opacity: .9;
    shape-rendering: crispEdges;
  }

  .node text {
    pointer-events: none;
    text-shadow: 0 1px 0 #fff;
    font-size: 12px;
  }

  .link {
    fill: none;
    stroke: #000;
    stroke-opacity: .2;
  }

  .link:hover {
    stroke-opacity: .5;
  }

  #warning{
    color: red;
  }
</style>
<!--
BEGIN NAV
 -->
    <script src="js/jquery.js"></script>
    <script>
    $(function(){
      $("#includedContent").load("nav.html");
    });
    </script>
<!--
END NAV
 -->
</head>
<body>


<!-- 
BEGIN NAV
 -->
	<div id="includedContent"></div>
<!-- 
END NAV
 -->

	<div class="row">
	
		<div class="ten columns">
		<div><h4 class="subheader">Example:Any City USA Adopted Revenues & Spending</h4>
					<p>Hover over the visual to see dollar amounts for funds and departments.

		</div>

			
			
    <div id="sankey">

      <p id="chart">
      </p>

      <h5>Source: City Website<a href="#">Click Me</a></h5>

      <h5>Notes:</h5><p>
      <ol>
       
        <li>Built using <a href="http://d3js.org/">D3.js</a> and the <a href="https://github.com/d3/d3-plugins/tree/master/sankey">Sankey D3 plugin</a>.</li>
      </ol></p>

    </div>

	</div>
    	</div>
    	</div>
    	
	<div class="row">
 		<div class="eight columns">


			<div id="disqus_thread"></div>

     	</div>
     </div>

  		
      
				<!-- Included JS Files (Uncompressed) -->
			<!-- 
				<script src="js/jquery.js"></script><script src="js/jquery.foundation.mediaQueryToggle.js"></script><script src="js/jquery.foundation.forms.js"></script><script src="js/jquery.foundation.reveal.js"></script><script src="js/jquery.foundation.orbit.js"></script><script src="js/jquery.foundation.navigation.js"></script><script src="js/jquery.foundation.buttons.js"></script><script src="js/jquery.foundation.tabs.js"></script><script src="js/jquery.foundation.tooltips.js"></script><script src="js/jquery.foundation.accordion.js"></script><script src="js/jquery.placeholder.js"></script><script src="js/jquery.foundation.alerts.js"></script><script src="js/jquery.foundation.topbar.js"></script><script src="js/jquery.foundation.joyride.js"></script><script src="js/jquery.foundation.clearing.js"></script><script src="js/jquery.foundation.magellan.js"></script>
			 -->



<!-- 
		Included JS Files (Compressed)			
 -->
			<script src="js/jquery.js"></script>
			
			<script src="js/foundation.min.js"></script>
  
<!-- 			Initialize JS Plugins	 -->		
	
			<script src="js/app.js"></script>


<!-- Sankey JS -->
<script src="./js/d3.v2.min.js"></script>
<script src="./js/sankey.js"></script>
<script src="./js/jquery-1.8.3.min.js"></script>


<script>

var margin = {top: 1, right: 1, bottom: 6, left: 1},
    width = 960 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;

var formatNumber = d3.format(",.0f"),
    format = function(d) { return "$" + formatNumber(d); },
    color = d3.scale.category20();

var svg = d3.select("#chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var sankey = d3.sankey()
    .nodeWidth(30)
    .nodePadding(5)
    .size([width, height]);

var path = sankey.link();

// Changed to budget
function do_with_budget(energy) {

  sankey
      .nodes(energy.nodes)
      .links(energy.links)
      .layout(32);

  var link = svg.append("g").selectAll(".link")
      .data(energy.links)
    .enter().append("path")
      .attr("class", "link")
      .attr("d", path)
      .style("stroke-width", function(d) { return Math.max(1, d.dy); })
      .sort(function(a, b) { return b.dy - a.dy; })
      .on("mouseover", function(d){$("#hover_description").append($("<span>" + d.source.name + " to " + d.target.name + ":  " + format(d.value) + "</span>"));})
      .on("mouseout", function(){$("#hover_description").find("span:last").remove();});;

  link.append("title")
      .text(function(d) { return d.source.name + " → " + d.target.name + "\n" + format(d.value); })


  var node = svg.append("g").selectAll(".node")
      .data(energy.nodes)
    .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })


  node.append("rect")
      .attr("height", function(d) { return d.dy; })
      .attr("width", sankey.nodeWidth())
      .style("fill", function(d) { return d.color = color(d.name.replace(/ .*/, "")); })
      .style("stroke", function(d) { return d3.rgb(d.color).darker(2); })
    .append("title")
      .text(function(d) { return d.name + "\n" + format(d.value); });

  node.append("text")
      .attr("x", -6)
      .attr("y", function(d) { return d.dy / 2; })
      .attr("dy", ".35em")
      .attr("text-anchor", "end")
      .attr("transform", null)
      .text(function(d) { return d.name; })
    .filter(function(d) { return d.x < width / 2; })
      .attr("x", 6 + sankey.nodeWidth())
      .attr("text-anchor", "start");
};

/* Data for visualization below */

cityData=
{"nodes":[
{"name":"Property Taxes"},
{"name":"User Fees"},
{"name":"Fire Assessment"},
{"name":"Other Revenues"},
{"name":"Fire"},
{"name":"Police"},
{"name":"Parks"}
],
"links":[
{"source":0,"target":4,"value":5},
{"source":0,"target":5,"value":15},
{"source":0,"target":6,"value":5},

{"source":1,"target":6,"value":10},

{"source":2,"target":4,"value":5},

{"source":3,"target":4,"value":15}



]};

do_with_budget(cityData);

</script>
	    		
    	
</body>
</html>
